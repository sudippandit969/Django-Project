{%extends "base.html"%}
{%block start%}

<div class="container mt-5 " >
    <div class="text-center">
      <button class="btn btn-primary px-4 py-5 mt-3"  onclick="toggleForm('form1')">Add Receipe</button>
      <button class="btn btn-primary px-4 py-5 mt-3"  onclick="toggleForm('form2')">Search Receipe</button>
    </div>

    <div class="mt-4 background-color:#772e25;" id="formContainer">
      <div id="form1" class="mt-4" style="display: none;">
        <form method="post" enctype="multipart/form-data" class="col-6 mx-auto card p-3 shadow-lg mt-2 ">
           {%csrf_token%}
             <h2>
              Add Receipe
             </h2>
           <hr></hr>
            <div class="mb-3">
              <label for="exampleInputEmail1" class="form-label">Receipe Name</label>
              <input name="receipe_name"  required type="text" class="form-control">
            </div>
            <div class="mb-3">
              <label for="exampleInputPassword1"  class="form-label">Receipe Descripsion</label>
              <textarea name="receipe_description" required class="form-control"></textarea>
            </div>
            <div class="mb-3">
                <label for="exampleInputPassword1"  class="form-label">Receipe Image</label>
                <input name="receipe_image" type="file" class="form-control">
              </div>

            <button type="submit" class="btn btn-success">Add</button>
          </form>
      </div>

      <div id="form2" class="card  col-md-6 mx-auto outline" style="display: none; ">
          <form method="get" action="/receipes/">
          <div class="mb-3">
            <label for="exampleInputPassword1"  class="form-label">Search Receipe</label>
            <input name="search" type="text" class="form-control">
            <button type="submit" class=" btn btn-primary mt-2 ">Search</button>
         </div>
        </form>
      </div>
    </div>
      {% if user.is_authenticated %}
                <!-- Show recipes -->
                <h2 style="color:#fdf0d5;">Welcome, {{ user.username }}!</h2>
      <table class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Receipe Name</th>
            <th scope="col">Receipe Description</th>
            <th scope="col">Image</th>
            <th scope="col">actions</th>
            
          </tr>
        </thead>

        <tbody>
          {% for receipe in receipes %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ receipe.receipe_name }}</td>
            <td>{{ receipe.receipe_description }}</td>
            <td><img src="/media/{{ receipe.receipe_image }}" style="height: 100px;"></td>
            <td>
              {% if receipe.user == request.user %}
                <a href="/delete_receipe/{{ receipe.id }}/" class="btn btn-danger">Delete</a>
                <a href="/update_receipe/{{ receipe.id }}/" class="btn btn-success">Update</a>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
          {% else %}
                <script>
                    // Force redirect if someone tries to access via back button
                    window.location.href = "/login/";
                </script>
            {% endif %}     
</div>
{% comment %} <script>
  function showForm(formId) {
    // Hide both forms first
    document.getElementById('form1').style.display = 'none';
    document.getElementById('form2').style.display = 'none';
    
    // Show the selected form
    document.getElementById(formId).style.display = 'block';
  }
</script> {% endcomment %}

<script>
  function toggleForm(formId) {
    const form1 = document.getElementById('form1');
    const form2 = document.getElementById('form2');

    // If clicked form is already visible, hide it
    if (document.getElementById(formId).style.display === 'block') {
      document.getElementById(formId).style.display = 'none';
    } else {
      // Hide both, then show the one clicked
      form1.style.display = 'none';
      form2.style.display = 'none';
      document.getElementById(formId).style.display = 'block';
    }
  }
</script>
{% comment %} <script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelector('#form2 form').addEventListener('submit', function (e) {
      e.preventDefault();
      // Handle search logic here
    });
  });
</script> {% endcomment %}

{% comment %} {% block start %}
{% endblock %} {% endcomment %}
{%endblock%}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
